# This configuration is used for local development environment.
# Profile: local (activate with -Dquarkus.profile=local)

# External Service Hosts (use environment variables with defaults for local dev)
postgresql-host: "${POSTGRES_HOST:127.0.0.1}"
postgresql-port: "${POSTGRES_PORT:5432}"
postgresql-user: "${POSTGRES_USER:postgres}"
postgresql-pass: "${POSTGRES_PASSWORD:postgres}"

event-hubs-host: "${KAFKA_HOST:127.0.0.1}"
schema-registry-host: "${SCHEMA_REGISTRY_HOST:127.0.0.1}"

redis-host: "${REDIS_HOST:127.0.0.1}"
redis-port: "${REDIS_PORT:6379}"
redis-pass: "${REDIS_PASSWORD:}"

# Quarkus Configuration
quarkus:

  # Datasource Configuration (PostgreSQL)
  datasource:
    db-kind: postgresql
    username: "${postgresql-user}"
    password: "${postgresql-pass}"
    jdbc:
      url: "jdbc:postgresql://${postgresql-host}:${postgresql-port}/yape_transactions"
      # Connection pool settings
      max-size: 16
      min-size: 4
      initial-size: 4
      idle-removal-interval: 2M
      max-lifetime: 30M

  # Redis Configuration
  redisson:
    threads: 16
    netty-threads: 32
    single-server-config:
      address: "redis://${redis-host}:${redis-port}"
      password:

  flyway:
    locations: classpath:db/migration
    baseline-on-migrate: true

  # Hibernate ORM Configuration
  hibernate-orm:
    log:
      sql: false

  devservices:
    enabled: false

  # Logging Configuration
  log:
    level: INFO
    category:
      "com.yape":
        level: DEBUG
      "org.hibernate.SQL":
        level: ERROR
      "io.smallrye.reactive.messaging":
        level: ERROR

  # SmallRye GraphQL Configuration
  smallrye-graphql:
    error-extension-fields:
      - exception
      - classification
      - code
    show-runtime-exception-message:
      - com.yape.services.shared.exception.BusinessException
      - com.yape.services.shared.exception.ValidationException
      - com.yape.services.shared.exception.ResourceNotFoundException

application:
  cache:
    transaction:
      map-name: "transactions"
      prefix: "transaction:"
      ttl:
        pending: 300
        approved: 3600
        rejected: 3600
    transfer-type:
      map-name: "transfer-types"
      prefix: "transfer_type:"
      ttl: 86400

# Kafka / Event Streaming Configuration
kafka:
  bootstrap:
    servers: "${event-hubs-host}:9092"
  schema:
    registry:
      url: "http://${schema-registry-host}:8081"

# MicroProfile Reactive Messaging Configuration
mp:
  messaging:
    outgoing:
      transaction-producer:
        connector: smallrye-kafka
        topic: transaction.created
        key:
          serializer: org.apache.kafka.common.serialization.StringSerializer
        value:
          serializer: io.confluent.kafka.serializers.KafkaAvroSerializer
        schema:
          registry:
            url: "http://${schema-registry-host}:8081"

    incoming:
      transaction-status-consumer:
        connector: smallrye-kafka
        topic: transaction.status
        group:
          id: ms-transaction-group
        auto:
          offset:
            reset: earliest
        failure-strategy: ignore
        key:
          deserializer: org.apache.kafka.common.serialization.StringDeserializer
        value:
          deserializer: io.confluent.kafka.serializers.KafkaAvroDeserializer
        schema:
          registry:
            url: "http://${schema-registry-host}:8081"
        specific:
          avro:
            reader: true
